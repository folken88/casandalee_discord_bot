services:
  cass-bot:
    build: .
    container_name: cass-discord-bot
    restart: unless-stopped
    volumes:
      - ./logs:/app/logs
      - ./.env:/app/.env
      - ./data:/app/data
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"
    environment:
      - DISCORD_TOKEN=${DISCORD_TOKEN}
      - CLIENT_ID=${CLIENT_ID}
      - GUILD_ID=${GUILD_ID}
      - OPENAI_API_KEY=${OPENAI_API_KEY}
      - ANTHROPIC_API_KEY=${ANTHROPIC_API_KEY}
      - OLLAMA_URL=${OLLAMA_URL}
      - OLLAMA_MODEL_FAST=${OLLAMA_MODEL_FAST}
      - OLLAMA_MODEL_QUALITY=${OLLAMA_MODEL_QUALITY}
      - GOOGLE_SHEETS_API_KEY=${GOOGLE_SHEETS_API_KEY}
      - GOOGLE_SHEETS_SPREADSHEET_ID=${GOOGLE_SHEETS_SPREADSHEET_ID}
      - GOOGLE_SHEETS_TIMELINE_RANGE=${GOOGLE_SHEETS_TIMELINE_RANGE}
      - GOOGLE_SHEETS_CHARACTERS_RANGE=${GOOGLE_SHEETS_CHARACTERS_RANGE}
      - GOOGLE_SHEETS_REFRESH_INTERVAL=${GOOGLE_SHEETS_REFRESH_INTERVAL}
      - BOT_NAME=Casandalee
      - BOT_PREFIX=/cass
      - CAMPAIGN_YEAR=4717
      - CAMPAIGN_MONTH=April
    networks:
      - cass-network
      - ollama-network

  cass-editor:
    build: .
    container_name: cass-personality-editor
    restart: unless-stopped
    command: node tools/personality-editor/server.js
    working_dir: /app
    ports:
      - "3960:3960"
    volumes:
      - ./data:/app/data
    environment:
      - PERSONALITY_EDITOR_PORT=3960
      - PERSONALITIES_DATA_DIR=/app/data/personalities
    networks:
      - cass-network

networks:
  cass-network:
    driver: bridge
  ollama-network:
    external: true
    name: docker-services_ollama-network


